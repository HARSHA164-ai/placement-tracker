<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Placement Tracker</a>
      <button class="btn btn-light ms-auto" onclick="logout()">Logout</button>
    </div>
  </nav>

  <!-- Content -->
 <div class="container mt-4">
  <h2>Welcome, Student!</h2>
  <p>This is your student dashboard. Below are your profile details:</p>

  <!-- Profile Card -->
  <div class="card shadow p-4 mt-3">
    <h4>My Profile</h4>
    <hr>
    <p><strong>Name:</strong> <span id="profileName"></span></p>
    <p><strong>Email:</strong> <span id="profileEmail"></span></p>
    <p><strong>Branch:</strong> <span id="profileBranch"></span></p>
    <p><strong>Roll No:</strong> <span id="profileRoll"></span></p>
    <p><strong>Skills:</strong> <span id="profileSkills"></span></p>
    <button class="btn btn-warning mt-3" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button>
  </div>
</div>

<!-- ðŸ”¹ Bootstrap Modal for Edit Profile -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label class="form-label">Branch</label>
          <input type="text" id="editBranch" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Roll No</label>
          <input type="text" id="editRollNo" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Skills (comma separated)</label>
          <input type="text" id="editSkills" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" onclick="updateProfile()" data-bs-dismiss="modal">Save Changes</button>
      </div>
    </div>
  </div>
</div>

  <!-- Firebase + Auth -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // Check auth state
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "index.html";
    } else {
      db.collection("student").doc(user.uid).get()
        .then(doc => {
          if (doc.exists) {
            const data = doc.data();

            // --- Profile Card Fill ---
            document.getElementById("profileName").innerText = data.name || "";
            document.getElementById("profileEmail").innerText = data.email || "";
            document.getElementById("profileBranch").innerText = data.branch || "";
            document.getElementById("profileRoll").innerText = data.rollNo || "";
            document.getElementById("profileSkills").innerText = data.skills ? data.skills.join(", ") : "";

            // --- Pre-fill modal inputs ---
            document.getElementById("editBranch").value = data.branch || "";
            document.getElementById("editRollNo").value = data.rollNo || "";
            document.getElementById("editSkills").value = data.skills ? data.skills.join(", ") : "";
          } else {
            alert("Profile not found in Firestore!");
          }
        })
        .catch(err => {
          console.error("Error fetching profile:", err);
          alert("Error: " + err.message);
        });
    }
  });

  // âœ… Update Profile Function
  function updateProfile() {
    const branch = document.getElementById("editBranch").value;
    const rollNo = document.getElementById("editRollNo").value;
    const skills = document.getElementById("editSkills").value.split(",").map(s => s.trim());

    const user = firebase.auth().currentUser;

    if (user) {
      db.collection("student").doc(user.uid).update({
        branch: branch,
        rollNo: rollNo,
        skills: skills
      })
      .then(() => {
        alert("Profile updated successfully!");

        // Refresh profile card
        document.getElementById("profileBranch").innerText = branch;
        document.getElementById("profileRoll").innerText = rollNo;
        document.getElementById("profileSkills").innerText = skills.join(", ");
      })
      .catch(err => {
        console.error("Error updating profile:", err);
        alert("Error: " + err.message);
      });
    } else {
      alert("User not logged in!");
    }
  }
</script>
</body>
</html>